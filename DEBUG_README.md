# Pipeline è°ƒè¯•å·¥å…·ä½¿ç”¨æŒ‡å—

## æ¦‚è¿°

è¿™å¥—è°ƒè¯•å·¥å…·èƒ½å¤Ÿè¯¦ç»†å±•ç¤ºæ–‡æ¡£å¤„ç† Pipeline ä¸­æ¯ä¸ªæ­¥éª¤çš„ä¸­é—´äº§å‡ºï¼Œå¸®åŠ©æ‚¨è§‚å¯Ÿå’Œè¯„ä¼°æ¯ä¸€æ­¥çš„å·¥ä½œè´¨é‡ã€‚

## åŠŸèƒ½ç‰¹æ€§

### ğŸ” å…¨æµç¨‹è°ƒè¯•
- **æ–‡æ¡£åŠ è½½**: å±•ç¤ºæ–‡æ¡£è§£æç»“æœã€å­—ç¬¦ç»Ÿè®¡
- **æ–‡æ¡£åˆ†å—**: æ˜¾ç¤ºåˆ†å—ç­–ç•¥æ•ˆæœã€å—å¤§å°åˆ†å¸ƒ
- **Embedding ç”Ÿæˆ**: æŸ¥çœ‹å‘é‡ç»´åº¦ã€ç›¸ä¼¼åº¦åˆ†å¸ƒ
- **Vector Store æ„å»º**: éªŒè¯å‘é‡å­˜å‚¨çŠ¶æ€
- **æ¦‚å¿µæå–**: è§‚å¯Ÿæå–çš„æ¦‚å¿µè´¨é‡å’Œæ•°é‡
- **æ¦‚å¿µåˆå¹¶**: æŸ¥çœ‹åˆå¹¶æ•ˆæœå’Œå»é‡æƒ…å†µ
- **è¯æ®æå–**: æ£€æŸ¥è¯æ®ä¸æ¦‚å¿µçš„å…³è”åº¦
- **æ£€ç´¢æµ‹è¯•**: éªŒè¯æ£€ç´¢å‡†ç¡®æ€§
- **é—®ç­”ç”Ÿæˆ**: è¯„ä¼°ç”Ÿæˆçš„é—®ç­”å¯¹è´¨é‡

### ğŸ“Š å¤šç§è¾“å‡ºæ ¼å¼
- **JSON æ–‡ä»¶**: æ¯ä¸ªæ­¥éª¤çš„è¯¦ç»†æ•°æ®
- **Markdown æŠ¥å‘Š**: å¯è¯»æ€§å¼ºçš„æ–‡æœ¬æŠ¥å‘Š
- **HTML æŠ¥å‘Š**: äº¤äº’å¼å¯è§†åŒ–æŠ¥å‘Š

## å¿«é€Ÿå¼€å§‹

### 1. åŸºæœ¬ä½¿ç”¨

```python
from debug_pipeline import PipelineDebugger

# åˆ›å»ºè°ƒè¯•å™¨
debugger = PipelineDebugger(
    config_path="config/config.yml",
    debug_output_dir="./debug_output"
)

# è°ƒè¯•å•ä¸ªæ–‡ä»¶
results = debugger.debug_full_pipeline("your_document.pdf")
```

### 2. å‘½ä»¤è¡Œä½¿ç”¨

```bash
# è°ƒè¯•å•ä¸ªæ–‡ä»¶
python debug_pipeline.py --file "attention is all you need.pdf" --output "./debug_output"

# ä½¿ç”¨è‡ªå®šä¹‰é…ç½®
python debug_pipeline.py --file "document.pdf" --config "custom_config.yml"
```

### 3. ä½¿ç”¨ç¤ºä¾‹è„šæœ¬

```bash
# è¿è¡Œé¢„è®¾çš„ç¤ºä¾‹
python debug_example.py
```

## è¾“å‡ºæ–‡ä»¶è¯´æ˜

è°ƒè¯•å®Œæˆåï¼Œä¼šåœ¨è¾“å‡ºç›®å½•ç”Ÿæˆä»¥ä¸‹æ–‡ä»¶ï¼š

### æ­¥éª¤è¯¦ç»†æ–‡ä»¶
- `01_document_loading.json` - æ–‡æ¡£åŠ è½½ç»“æœ
- `02_chunking.json` - æ–‡æ¡£åˆ†å—ç»“æœ  
- `03_embedding.json` - Embedding ç”Ÿæˆç»“æœ
- `04_vector_store.json` - Vector Store æ„å»ºç»“æœ
- `05_concept_extraction.json` - æ¦‚å¿µæå–ç»“æœ
- `06_concept_merging.json` - æ¦‚å¿µåˆå¹¶ç»“æœ
- `07_evidence_extraction.json` - è¯æ®æå–ç»“æœ
- `08_retrieval.json` - æ£€ç´¢æµ‹è¯•ç»“æœ
- `09_qa_generation.json` - é—®ç­”ç”Ÿæˆç»“æœ

### æ±‡æ€»æŠ¥å‘Š
- `{filename}_debug_results.json` - å®Œæ•´è°ƒè¯•ç»“æœ
- `{filename}_debug_report.md` - Markdown æ ¼å¼æŠ¥å‘Š
- `{filename}_debug_report.html` - äº¤äº’å¼ HTML æŠ¥å‘Š

## è¯¦ç»†ä½¿ç”¨è¯´æ˜

### æ–‡æ¡£åŠ è½½è°ƒè¯•

æŸ¥çœ‹æ–‡æ¡£æ˜¯å¦æ­£ç¡®è§£æï¼š
```json
{
  "success": true,
  "documents_count": 1,
  "total_characters": 45678,
  "document_details": [
    {
      "index": 0,
      "text_length": 45678,
      "text_preview": "Attention Is All You Need...",
      "metadata": {...}
    }
  ]
}
```

**å…³æ³¨ç‚¹**:
- æ–‡æ¡£æ˜¯å¦å®Œæ•´åŠ è½½
- å­—ç¬¦æ•°æ˜¯å¦åˆç†
- æ–‡æœ¬é¢„è§ˆæ˜¯å¦æ­£ç¡®

### æ–‡æ¡£åˆ†å—è°ƒè¯•

æ£€æŸ¥åˆ†å—ç­–ç•¥æ•ˆæœï¼š
```json
{
  "success": true,
  "chunks_count": 23,
  "chunking_stats": {
    "avg_chunk_length": 1987.2,
    "min_chunk_length": 856,
    "max_chunk_length": 3421
  }
}
```

**å…³æ³¨ç‚¹**:
- å—æ•°é‡æ˜¯å¦åˆé€‚
- å—å¤§å°åˆ†å¸ƒæ˜¯å¦å‡åŒ€
- æ˜¯å¦æœ‰è¿‡å°æˆ–è¿‡å¤§çš„å—

### æ¦‚å¿µæå–è°ƒè¯•

è¯„ä¼°æ¦‚å¿µæå–è´¨é‡ï¼š
```json
{
  "success": true,
  "concepts_count": 45,
  "concept_stats": {
    "avg_concepts_per_chunk": 1.96,
    "total_concepts": 45
  },
  "concept_details": [
    {
      "chunk_index": 0,
      "concepts_count": 2,
      "concepts": [
        {
          "concept_text": "attention mechanism",
          "confidence": 0.85
        }
      ]
    }
  ]
}
```

**å…³æ³¨ç‚¹**:
- æ¦‚å¿µæ•°é‡æ˜¯å¦åˆç†
- æ¦‚å¿µè´¨é‡å’Œç›¸å…³æ€§
- ç½®ä¿¡åº¦åˆ†å¸ƒ

### æ¦‚å¿µåˆå¹¶è°ƒè¯•

æ£€æŸ¥å»é‡å’Œåˆå¹¶æ•ˆæœï¼š
```json
{
  "success": true,
  "original_concepts_count": 45,
  "merged_concepts_count": 32,
  "merge_stats": {
    "reduction_ratio": 0.289,
    "concepts_before": 45,
    "concepts_after": 32
  }
}
```

**å…³æ³¨ç‚¹**:
- åˆå¹¶æ¯”ä¾‹æ˜¯å¦åˆç†
- æ˜¯å¦è¿‡åº¦åˆå¹¶æˆ–åˆå¹¶ä¸è¶³
- é‡è¦æ¦‚å¿µæ˜¯å¦è¢«ä¿ç•™

### é—®ç­”ç”Ÿæˆè°ƒè¯•

è¯„ä¼°é—®ç­”å¯¹è´¨é‡ï¼š
```json
{
  "success": true,
  "qa_pairs_count": 15,
  "qa_stats": {
    "total_qa_pairs": 15,
    "question_types": ["factual", "analytical", "conceptual"],
    "avg_question_length": 67.3,
    "avg_answer_length": 234.7
  }
}
```

**å…³æ³¨ç‚¹**:
- é—®ç­”å¯¹æ•°é‡
- é—®é¢˜ç±»å‹åˆ†å¸ƒ
- é—®ç­”é•¿åº¦æ˜¯å¦åˆé€‚

## è´¨é‡è¯„ä¼°æŒ‡æ ‡

### 1. æ–‡æ¡£å¤„ç†è´¨é‡
- **å®Œæ•´æ€§**: æ–‡æ¡£æ˜¯å¦å®Œæ•´åŠ è½½
- **åˆ†å—åˆç†æ€§**: å—å¤§å°åˆ†å¸ƒæ˜¯å¦å‡åŒ€
- **ä¿¡æ¯ä¿ç•™**: é‡è¦ä¿¡æ¯æ˜¯å¦è¢«ä¿ç•™

### 2. æ¦‚å¿µæå–è´¨é‡  
- **è¦†ç›–åº¦**: é‡è¦æ¦‚å¿µæ˜¯å¦è¢«æå–
- **å‡†ç¡®æ€§**: æå–çš„æ¦‚å¿µæ˜¯å¦å‡†ç¡®
- **å»é‡æ•ˆæœ**: é‡å¤æ¦‚å¿µæ˜¯å¦è¢«åˆå¹¶

### 3. æ£€ç´¢è´¨é‡
- **ç›¸å…³æ€§**: æ£€ç´¢ç»“æœæ˜¯å¦ç›¸å…³
- **æ’åºè´¨é‡**: ç›¸ä¼¼åº¦æ’åºæ˜¯å¦åˆç†
- **å¬å›ç‡**: ç›¸å…³å†…å®¹æ˜¯å¦è¢«æ£€ç´¢åˆ°

### 4. é—®ç­”è´¨é‡
- **å¤šæ ·æ€§**: é—®é¢˜ç±»å‹æ˜¯å¦å¤šæ ·
- **å‡†ç¡®æ€§**: ç­”æ¡ˆæ˜¯å¦å‡†ç¡®
- **å®Œæ•´æ€§**: ç­”æ¡ˆæ˜¯å¦å®Œæ•´

## å¸¸è§é—®é¢˜æ’æŸ¥

### 1. æ–‡æ¡£åŠ è½½å¤±è´¥
- æ£€æŸ¥æ–‡ä»¶è·¯å¾„æ˜¯å¦æ­£ç¡®
- ç¡®è®¤æ–‡ä»¶æ ¼å¼æ˜¯å¦æ”¯æŒ
- æŸ¥çœ‹é”™è¯¯æ—¥å¿—äº†è§£å…·ä½“åŸå› 

### 2. æ¦‚å¿µæå–æ•ˆæœå·®
- è°ƒæ•´æ¦‚å¿µæå–çš„ prompt
- æ£€æŸ¥æ¨¡å‹é…ç½®æ˜¯å¦æ­£ç¡®
- è€ƒè™‘è°ƒæ•´åˆ†å—å¤§å°

### 3. æ£€ç´¢ç»“æœä¸å‡†ç¡®
- æ£€æŸ¥ embedding æ¨¡å‹é…ç½®
- è°ƒæ•´ç›¸ä¼¼åº¦é˜ˆå€¼
- éªŒè¯å‘é‡å­˜å‚¨æ˜¯å¦æ­£ç¡®æ„å»º

### 4. é—®ç­”è´¨é‡ä¸é«˜
- ä¼˜åŒ–é—®ç­”ç”Ÿæˆçš„ prompt
- è°ƒæ•´é—®é¢˜ç±»å‹é…ç½®
- æ£€æŸ¥è¾“å…¥æ–‡æœ¬è´¨é‡

## é…ç½®ä¼˜åŒ–å»ºè®®

### 1. åˆ†å—å‚æ•°è°ƒæ•´
```yaml
chunking:
  chunk_size: 1000      # æ ¹æ®æ–‡æ¡£ç±»å‹è°ƒæ•´
  chunk_overlap: 200    # ä¿è¯ä¿¡æ¯è¿ç»­æ€§
  separator: "\n\n"     # é€‰æ‹©åˆé€‚çš„åˆ†éš”ç¬¦
```

### 2. æ¦‚å¿µæå–ä¼˜åŒ–
```yaml
concept_extraction:
  max_concepts_per_chunk: 3  # æ§åˆ¶æ¦‚å¿µæ•°é‡
  min_confidence: 0.7        # è®¾ç½®ç½®ä¿¡åº¦é˜ˆå€¼
```

### 3. æ£€ç´¢å‚æ•°è°ƒæ•´
```yaml
retrieval:
  top_k: 5              # æ£€ç´¢ç»“æœæ•°é‡
  similarity_threshold: 0.7  # ç›¸ä¼¼åº¦é˜ˆå€¼
```

## é«˜çº§åŠŸèƒ½

### 1. è‡ªå®šä¹‰è°ƒè¯•æ­¥éª¤

```python
# åªè°ƒè¯•ç‰¹å®šæ­¥éª¤
debugger = PipelineDebugger()

# å•ç‹¬è°ƒè¯•æ–‡æ¡£åŠ è½½
doc_result = debugger._debug_document_loading("file.pdf")

# å•ç‹¬è°ƒè¯•æ¦‚å¿µæå–
concept_result = debugger._debug_concept_extraction(chunks)
```

### 2. æ‰¹é‡è°ƒè¯•

```python
import os

debugger = PipelineDebugger()

# æ‰¹é‡å¤„ç†ç›®å½•ä¸­çš„æ–‡ä»¶
for filename in os.listdir("documents/"):
    if filename.endswith(".pdf"):
        results = debugger.debug_full_pipeline(f"documents/{filename}")
```

### 3. ç»“æœå¯¹æ¯”

```python
# å¯¹æ¯”ä¸åŒé…ç½®çš„æ•ˆæœ
config1_results = debugger.debug_full_pipeline("doc.pdf")
debugger.config_path = "config2.yml"
config2_results = debugger.debug_full_pipeline("doc.pdf")

# å¯¹æ¯”å…³é”®æŒ‡æ ‡
print(f"é…ç½®1æ¦‚å¿µæ•°: {config1_results['step_results']['concept_extraction']['concepts_count']}")
print(f"é…ç½®2æ¦‚å¿µæ•°: {config2_results['step_results']['concept_extraction']['concepts_count']}")
```

## æœ€ä½³å®è·µ

### 1. è°ƒè¯•æµç¨‹
1. å…ˆè¿è¡Œå®Œæ•´è°ƒè¯•ï¼ŒæŸ¥çœ‹æ•´ä½“çŠ¶å†µ
2. é‡ç‚¹å…³æ³¨å¤±è´¥çš„æ­¥éª¤
3. é€æ­¥ä¼˜åŒ–é…ç½®å‚æ•°
4. é‡æ–°è°ƒè¯•éªŒè¯æ”¹è¿›æ•ˆæœ

### 2. ç»“æœåˆ†æ
1. æŸ¥çœ‹ HTML æŠ¥å‘Šè·å¾—ç›´è§‚æ¦‚è§ˆ
2. æ£€æŸ¥ JSON æ–‡ä»¶äº†è§£è¯¦ç»†æ•°æ®
3. å…³æ³¨å…³é”®è´¨é‡æŒ‡æ ‡
4. å¯¹æ¯”ä¸åŒé…ç½®çš„æ•ˆæœ

### 3. æ€§èƒ½ä¼˜åŒ–
1. æ ¹æ®æ–‡æ¡£ç‰¹ç‚¹è°ƒæ•´åˆ†å—ç­–ç•¥
2. ä¼˜åŒ–æ¦‚å¿µæå–çš„å‡†ç¡®æ€§
3. è°ƒæ•´æ£€ç´¢å‚æ•°æé«˜ç›¸å…³æ€§
4. æŒç»­ç›‘æ§å’Œæ”¹è¿›

## æŠ€æœ¯æ”¯æŒ

å¦‚æœé‡åˆ°é—®é¢˜ï¼Œè¯·ï¼š
1. æŸ¥çœ‹ç”Ÿæˆçš„é”™è¯¯æ—¥å¿—
2. æ£€æŸ¥é…ç½®æ–‡ä»¶æ ¼å¼
3. ç¡®è®¤ä¾èµ–åŒ…ç‰ˆæœ¬
4. å‚è€ƒç¤ºä¾‹ä»£ç 

---

é€šè¿‡è¿™å¥—è°ƒè¯•å·¥å…·ï¼Œæ‚¨å¯ä»¥æ·±å…¥äº†è§£ Pipeline æ¯ä¸ªæ­¥éª¤çš„å·¥ä½œæƒ…å†µï¼ŒåŠæ—¶å‘ç°é—®é¢˜å¹¶è¿›è¡Œä¼˜åŒ–ï¼Œç¡®ä¿æœ€ç»ˆè¾“å‡ºçš„è´¨é‡ã€‚ 